name: Deploy
on:
  - workflow_call
  - workflow_dispatch
jobs:
  deploy:
    permissions:
      pages: write
      id-token: write

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Node.js v23
        uses: actions/setup-node@v3
        with:
          node-version: 23
      - run: npm install --frozen-lockfile
      - run: npm run tsc
      - run: npm exec vite -- -c site/vite.config.js build --minify false --base dropflow/
      - run: cp assets/logo-afe.png dist/site/assets
      - name: Upload site
        uses: actions/upload-pages-artifact@v3
        with:
          name: github-pages
          path: dist/site/
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
